economy_setup = {
	update_gdp = yes
	update_finances = yes
}

update_finances = {
	set_variable = { monthly_revenue = 0 }
	set_variable = { monthly_expenses = 0 }

	# INCOME - TAXES
	if = {
		limit = {
			has_idea = very_high_taxes
		}
		set_variable = { monthly_income_tax_revenue  = 0.2 }
		multiply_variable = {
			var = monthly_income_tax_revenue
			value = ROOT.max_manpower
		}
		multiply_variable = {
			var = monthly_income_tax_revenue
			value = 0.66
		}
	}
	if = {
		limit = {
			has_idea = high_taxes
		}
		set_variable = { monthly_income_tax_revenue  = 0.15 }
		multiply_variable = {
			var = monthly_income_tax_revenue
			value = ROOT.max_manpower
		}
	}
	if = {
		limit = {
			has_idea = moderate_taxes
		}
		set_variable = { monthly_income_tax_revenue  = 0.1 }
		multiply_variable = {
			var = monthly_income_tax_revenue
			value = ROOT.max_manpower
		}
		multiply_variable = {
			var = monthly_income_tax_revenue
			value = 0.66
		}
	}
	if = {
		limit = {
			has_idea = low_taxes
		}
		set_variable = { monthly_income_tax_revenue  = 0.05 }
		multiply_variable = {
			var = monthly_income_tax_revenue
			value = ROOT.max_manpower
		}
		multiply_variable = {
			var = monthly_income_tax_revenue
			value = 0.66
		}
	}
	if = {
		limit = {
			has_idea = very_low_taxes
		}
		set_variable = { monthly_income_tax_revenue  = 0.01 }
		multiply_variable = {
			var = monthly_income_tax_revenue
			value = ROOT.max_manpower
		}
		multiply_variable = {
			var = monthly_income_tax_revenue
			value = 0.66
		}
	}
	round_variable = monthly_income_tax_revenue

	# EXPENSES - SOCIAL WELFARE BUDGET
	if = {
		limit = {
			has_idea = extensive_welfare_spending
		}
		set_variable = { monthly_welfare_expenses = 0.075 }
		multiply_variable = {
			var = monthly_welfare_expenses
			value = ROOT.max_manpower
		}
	}
	if = {
		limit = {
			has_idea = moderate_welfare_spending
		}
		set_variable = { monthly_welfare_expenses = 0.05 }
		multiply_variable = {
			var = monthly_healthcare_expenses
			value = ROOT.max_manpower
		}
	}
	if = {
		limit = {
			has_idea = minimal_welfare_spending
		}
		set_variable = { monthly_welfare_expenses = 0.015 }
		multiply_variable = {
			var = monthly_welfare_expenses
			value = ROOT.max_manpower
		}
	}
	round_variable = monthly_welfare_expenses

	# EXPENSES - EDUCATION BUDGET
	if = {
		limit = {
			has_idea = extensive_education_spending
		}
		set_variable = { monthly_education_expenses = 0.075 }
		multiply_variable = {
			var = monthly_education_expenses
			value = ROOT.max_manpower
		}
	}
	if = {
		limit = {
			has_idea = moderate_education_spending
		}
		set_variable = { monthly_education_expenses = 0.05 }
		multiply_variable = {
			var = monthly_healthcare_expenses
			value = ROOT.max_manpower
		}
	}
	if = {
		limit = {
			has_idea = minimal_education_spending
		}
		set_variable = { monthly_education_expenses = 0.015 }
		multiply_variable = {
			var = monthly_education_expenses
			value = ROOT.max_manpower
		}
	}
	round_variable = monthly_education_expenses

	# EXPENSES - HEALTHCARE BUDGET
	if = {
		limit = {
			has_idea = extensive_healthcare_spending
		}
		set_variable = { monthly_healthcare_expenses = 0.075 }
		multiply_variable = {
			var = monthly_healthcare_expenses
			value = ROOT.max_manpower
		}
	}
	if = {
		limit = {
			has_idea = moderate_healthcare_spending
		}
		set_variable = { monthly_healthcare_expenses = 0.05 }
		multiply_variable = {
			var = monthly_healthcare_expenses
			value = ROOT.max_manpower
		}
	}
	if = {
		limit = {
			has_idea = minimal_healthcare_spending
		}
		set_variable = { monthly_healthcare_expenses = 0.015 }
		multiply_variable = {
			var = monthly_healthcare_expenses
			value = ROOT.max_manpower
		}
	}
	round_variable = monthly_healthcare_expenses

	# EXPENSES - DEFENSE BUDGET
	if = {
		limit = {
			has_idea = extensive_defense_spending
		}
		set_variable = { monthly_defense_expenses = 0.5 }
		multiply_variable = {
			var = monthly_defense_expenses
			value = ROOT.manpower
		}
	}
	if = {
		limit = {
			has_idea = moderate_defense_spending
		}
		set_variable = { monthly_defense_expenses = 0.25 }
		multiply_variable = {
			var = monthly_defense_expenses
			value = ROOT.manpower
		}
	}
	if = {
		limit = {
			has_idea = minimal_defense_spending
		}
		set_variable = { monthly_defense_expenses = 0.01 }
		multiply_variable = {
			var = monthly_defense_expenses
			value = ROOT.manpower
		}
	}
	round_variable = monthly_defense_expenses

	# EXPENSES - LAW ENFORCEMENT BUDGET
	if = {
		limit = {
			has_idea = extensive_law_enforcement_spending
		}
		set_variable = { monthly_law_enforcement_expenses = 0.075 }
		multiply_variable = {
			var = monthly_law_enforcement_expenses
			value = ROOT.max_manpower
		}
	}
	if = {
		limit = {
			has_idea = moderate_law_enforcement_spending
		}
		set_variable = { monthly_law_enforcement_expenses = 0.05 }
		multiply_variable = {
			var = monthly_law_enforcement_expenses
			value = ROOT.max_manpower
		}
	}
	if = {
		limit = {
			has_idea = minimal_law_enforcement_spending
		}
		set_variable = { monthly_law_enforcement_expenses = 0.015 }
		multiply_variable = {
			var = monthly_law_enforcement_expenses
			value = ROOT.max_manpower
		}
	}
	round_variable = monthly_law_enforcement_expenses

	# EXPENSES - ECONOMIC SUBSIDIES
	if = {
		limit = {
			has_idea = extensive_economic_subsidies
		}
		set_variable = { monthly_economic_subsidies = 0.005 }
		multiply_variable = {
			var = monthly_economic_subsidies
			value = gross_domestic_product
		}
	}
	if = {
		limit = {
			has_idea = moderate_economic_subsidies
		}
		set_variable = { monthly_economic_subsidies = 0.0025 }
		multiply_variable = {
			var = monthly_economic_subsidies
			value = gross_domestic_product
		}
	}
	if = {
		limit = {
			has_idea = minimal_economic_subsidies
		}
		set_variable = { monthly_economic_subsidies = 0.001 }
		multiply_variable = {
			var = monthly_economic_subsidies
			value = gross_domestic_product
		}
	}
	round_variable = monthly_economic_subsidies

	# CALCULATIONS

	add_to_variable = {
		var = monthly_revenue
		value = monthly_income_tax_revenue
	}
	round_variable = monthly_revenue

	add_to_variable = {
		var = monthly_expenses
		value = monthly_welfare_expenses
	}
	add_to_variable = {
		var = monthly_expenses
		value = monthly_education_expenses
	}
	add_to_variable = {
		var = monthly_expenses
		value = monthly_healthcare_expenses
	}
	add_to_variable = {
		var = monthly_expenses
		value = monthly_defense_expenses
	}
	add_to_variable = {
		var = monthly_expenses
		value = monthly_law_enforcement_expenses
	}
	add_to_variable = {
		var = monthly_expenses
		value = monthly_economic_subsidies
	}
	round_variable = monthly_expenses

	set_variable = { monthly_net_income = monthly_revenue }
	subtract_from_variable = {
		var = monthly_net_income
		value = monthly_expenses
	}
	round_variable = monthly_net_income
}

update_gdp = {
	set_variable = { gross_domestic_product = 0 }
	every_owned_state = {
		add_to_variable = {
			var = gross_domestic_product
			value = building_level@military_industry
		}
		add_to_variable = {
			var = gross_domestic_product
			value = building_level@civilian_industry
		}
		add_to_variable = {
			var = gross_domestic_product
			value = building_level@shipyard
		}
	}
	multiply_variable = {
		var = gross_domestic_product
		value = 1000000
	}
	set_variable = { gross_domestic_product_per_capita = gross_domestic_product }
	divide_variable = {
		var = gross_domestic_product_per_capita
		value = ROOT.manpower
	}
}

monthly_economy_pulse = {
	update_finances = yes
	add_to_variable = {
		var = state_treasury
		value = monthly_net_income
	}
}